package mysql

import (
	"testing"

	rulepkg "github.com/actiontech/sqle/sqle/driver/mysql/rule"
	"github.com/actiontech/sqle/sqle/driver/mysql/rule/ai"
	"github.com/actiontech/sqle/sqle/driver/mysql/session"
)

// ==== Rule test code start ====
func TestRuleSQLE00107(t *testing.T) {
	ruleName := ai.SQLE00107
	rule := rulepkg.RuleHandlerMap[ruleName].Rule

	runAIRuleCase(rule, t, "case 1: DELETE语句长度超过1024字符",
		"DELETE FROM test_table WHERE column1 = 'value1' AND column2 = 'value2' AND column3 = 'value3' AND column4 = 'value4' AND column5 = 'value5' AND column6 = 'value6' AND column7 = 'value7' AND column8 = 'value8' AND column9 = 'value9' AND column10 = 'value10' AND column11 = 'value11' AND column12 = 'value12' AND column13 = 'value13' AND column14 = 'value14' AND column15 = 'value15' AND column16 = 'value16' AND column17 = 'value17' AND column18 = 'value18' AND column19 = 'value19' AND column20 = 'value20' AND column21 = 'value21' AND column22 = 'value22' AND column23 = 'value23' AND column24 = 'value24' AND column25 = 'value25' AND column26 = 'value26' AND column27 = 'value27' AND column28 = 'value28' AND column29 = 'value29' AND column30 = 'value30' AND column31 = 'value31' AND column32 = 'value32' AND column33 = 'value33' AND column34 = 'value34' AND column35 = 'value35' AND column36 = 'value36' AND column37 = 'value37' AND column38 = 'value38' AND column39 = 'value39' AND column40 = 'value40' AND column41 = 'value41' AND column42 = 'value42' AND column43 = 'value43' AND column44 = 'value44' AND column45 = 'value45' AND column46 = 'value46' AND column47 = 'value47' AND column48 = 'value48' AND column49 = 'value49' AND column50 = 'value50';",
		session.NewAIMockContext().WithSQL("CREATE TABLE test_table (column1  VARCHAR(50), column2  VARCHAR(50), column3  VARCHAR(50), column4  VARCHAR(50), column5  VARCHAR(50),column6  VARCHAR(50),column7  VARCHAR(50),column8  VARCHAR(50),column9  VARCHAR(50),column10  VARCHAR(50), column11  VARCHAR(50), column12  VARCHAR(50), column13  VARCHAR(50),column14  VARCHAR(50),column15  VARCHAR(50),column16  VARCHAR(50), column17  VARCHAR(50), column18  VARCHAR(50), column19  VARCHAR(50),column20  VARCHAR(50),column21  VARCHAR(50),column22  VARCHAR(50),column23 VARCHAR(50),column24 VARCHAR(50),column25 VARCHAR(50),column26 VARCHAR(50),column27 VARCHAR(50), column28  VARCHAR(50),column29  VARCHAR(50),column30  VARCHAR(50),column31  VARCHAR(50),column32  VARCHAR(50),column33 VARCHAR(50),column34 VARCHAR(50),column35 VARCHAR(50),column36 VARCHAR(50),column37 VARCHAR(50), column38  VARCHAR(50),column39  VARCHAR(50),column40  VARCHAR(50),column41  VARCHAR(50),column42  VARCHAR(50),column43 VARCHAR(50),column44 VARCHAR(50),column45 VARCHAR(50),column46 VARCHAR(50),column47 VARCHAR(50), column48  VARCHAR(50),column49  VARCHAR(50),column50  VARCHAR(50)		)"),
		nil, newTestResult().addResult(ruleName))

	runAIRuleCase(rule, t, "case 2: DELETE语句长度小于1024字符",
		"DELETE FROM test_table WHERE column1 = 'value1';",
		session.NewAIMockContext().WithSQL("CREATE TABLE test_table (column1  VARCHAR(50), column2  VARCHAR(50), column3  VARCHAR(50), column4  VARCHAR(50), column5  VARCHAR(50),column6  VARCHAR(50),column7  VARCHAR(50),column8  VARCHAR(50),column9  VARCHAR(50),column10  VARCHAR(50), column11  VARCHAR(50), column12  VARCHAR(50), column13  VARCHAR(50),column14  VARCHAR(50),column15  VARCHAR(50),column16  VARCHAR(50), column17  VARCHAR(50), column18  VARCHAR(50), column19  VARCHAR(50),column20  VARCHAR(50),column21  VARCHAR(50),column22  VARCHAR(50),column23 VARCHAR(50),column24 VARCHAR(50),column25 VARCHAR(50),column26 VARCHAR(50),column27 VARCHAR(50), column28  VARCHAR(50),column29  VARCHAR(50),column30  VARCHAR(50),column31  VARCHAR(50),column32  VARCHAR(50),column33 VARCHAR(50),column34 VARCHAR(50),column35 VARCHAR(50),column36 VARCHAR(50),column37 VARCHAR(50), column38  VARCHAR(50),column39  VARCHAR(50),column40  VARCHAR(50),column41  VARCHAR(50),column42  VARCHAR(50),column43 VARCHAR(50),column44 VARCHAR(50),column45 VARCHAR(50),column46 VARCHAR(50),column47 VARCHAR(50), column48  VARCHAR(50),column49  VARCHAR(50),column50  VARCHAR(50)		)"),
		nil, newTestResult())

	runAIRuleCase(rule, t, "case 3: INSERT语句长度超过1024字符",
		"INSERT INTO test_table (column1, column2, column3, column4, column5, column6, column7, column8, column9, column10, column11, column12, column13, column14, column15, column16, column17, column18, column19, column20, column21, column22, column23, column24, column25, column26, column27, column28, column29, column30, column31, column32, column33, column34, column35, column36, column37, column38, column39, column40, column41, column42, column43, column44, column45, column46, column47, column48, column49, column50) VALUES ('value1', 'value2', 'value3', 'value4', 'value5', 'value6', 'value7', 'value8', 'value9', 'value10', 'value11', 'value12', 'value13', 'value14', 'value15', 'value16', 'value17', 'value18', 'value19', 'value20', 'value21', 'value22', 'value23', 'value24', 'value25', 'value26', 'value27', 'value28', 'value29', 'value30', 'value31', 'value32', 'value33', 'value34', 'value35', 'value36', 'value37', 'value38', 'value39', 'value40', 'value41', 'value42', 'value43', 'value44', 'value45', 'value46', 'value47', 'value48', 'value49', 'value50');",
		session.NewAIMockContext().WithSQL("CREATE TABLE test_table (column1  VARCHAR(50), column2  VARCHAR(50), column3  VARCHAR(50), column4  VARCHAR(50), column5  VARCHAR(50),column6  VARCHAR(50),column7  VARCHAR(50),column8  VARCHAR(50),column9  VARCHAR(50),column10  VARCHAR(50), column11  VARCHAR(50), column12  VARCHAR(50), column13  VARCHAR(50),column14  VARCHAR(50),column15  VARCHAR(50),column16  VARCHAR(50), column17  VARCHAR(50), column18  VARCHAR(50), column19  VARCHAR(50),column20  VARCHAR(50),column21  VARCHAR(50),column22  VARCHAR(50),column23 VARCHAR(50),column24 VARCHAR(50),column25 VARCHAR(50),column26 VARCHAR(50),column27 VARCHAR(50), column28  VARCHAR(50),column29  VARCHAR(50),column30  VARCHAR(50),column31  VARCHAR(50),column32  VARCHAR(50),column33 VARCHAR(50),column34 VARCHAR(50),column35 VARCHAR(50),column36 VARCHAR(50),column37 VARCHAR(50), column38  VARCHAR(50),column39  VARCHAR(50),column40  VARCHAR(50),column41  VARCHAR(50),column42  VARCHAR(50),column43 VARCHAR(50),column44 VARCHAR(50),column45 VARCHAR(50),column46 VARCHAR(50),column47 VARCHAR(50), column48  VARCHAR(50),column49  VARCHAR(50),column50  VARCHAR(50)		)"),
		nil, newTestResult().addResult(ruleName))

	runAIRuleCase(rule, t, "case 4: INSERT语句长度小于1024字符",
		"INSERT INTO test_table (column1) VALUES ('value1');",
		session.NewAIMockContext().WithSQL("CREATE TABLE test_table (column1  VARCHAR(50), column2  VARCHAR(50), column3  VARCHAR(50), column4  VARCHAR(50), column5  VARCHAR(50),column6  VARCHAR(50),column7  VARCHAR(50),column8  VARCHAR(50),column9  VARCHAR(50),column10  VARCHAR(50), column11  VARCHAR(50), column12  VARCHAR(50), column13  VARCHAR(50),column14  VARCHAR(50),column15  VARCHAR(50),column16  VARCHAR(50), column17  VARCHAR(50), column18  VARCHAR(50), column19  VARCHAR(50),column20  VARCHAR(50),column21  VARCHAR(50),column22  VARCHAR(50),column23 VARCHAR(50),column24 VARCHAR(50),column25 VARCHAR(50),column26 VARCHAR(50),column27 VARCHAR(50), column28  VARCHAR(50),column29  VARCHAR(50),column30  VARCHAR(50),column31  VARCHAR(50),column32  VARCHAR(50),column33 VARCHAR(50),column34 VARCHAR(50),column35 VARCHAR(50),column36 VARCHAR(50),column37 VARCHAR(50), column38  VARCHAR(50),column39  VARCHAR(50),column40  VARCHAR(50),column41  VARCHAR(50),column42  VARCHAR(50),column43 VARCHAR(50),column44 VARCHAR(50),column45 VARCHAR(50),column46 VARCHAR(50),column47 VARCHAR(50), column48  VARCHAR(50),column49  VARCHAR(50),column50  VARCHAR(50)		)"),
		nil, newTestResult())

	runAIRuleCase(rule, t, "case 5: UPDATE语句长度超过1024字符",
		"UPDATE test_table SET column1 = 'value1', column2 = 'value2', column3 = 'value3', column4 = 'value4', column5 = 'value5', column6 = 'value6', column7 = 'value7', column8 = 'value8', column9 = 'value9', column10 = 'value10', column11 = 'value11', column12 = 'value12', column13 = 'value13', column14 = 'value14', column15 = 'value15', column16 = 'value16', column17 = 'value17', column18 = 'value18', column19 = 'value19', column20 = 'value20', column21 = 'value21', column22 = 'value22', column23 = 'value23', column24 = 'value24', column25 = 'value25', column26 = 'value26', column27 = 'value27', column28 = 'value28', column29 = 'value29', column30 = 'value30', column31 = 'value31', column32 = 'value32', column33 = 'value33', column34 = 'value34', column35 = 'value35', column36 = 'value36', column37 = 'value37', column38 = 'value38', column39 = 'value39', column40 = 'value40', column41 = 'value41', column42 = 'value42', column43 = 'value43', column44 = 'value44', column45 = 'value45', column46 = 'value46', column47 = 'value47', column48 = 'value48', column49 = 'value49', column50 = 'value50' WHERE id = 1;",
		session.NewAIMockContext().WithSQL("CREATE TABLE test_table (id int,column1  VARCHAR(50), column2  VARCHAR(50), column3  VARCHAR(50), column4  VARCHAR(50), column5  VARCHAR(50),column6  VARCHAR(50),column7  VARCHAR(50),column8  VARCHAR(50),column9  VARCHAR(50),column10  VARCHAR(50), column11  VARCHAR(50), column12  VARCHAR(50), column13  VARCHAR(50),column14  VARCHAR(50),column15  VARCHAR(50),column16  VARCHAR(50), column17  VARCHAR(50), column18  VARCHAR(50), column19  VARCHAR(50),column20  VARCHAR(50),column21  VARCHAR(50),column22  VARCHAR(50),column23 VARCHAR(50),column24 VARCHAR(50),column25 VARCHAR(50),column26 VARCHAR(50),column27 VARCHAR(50), column28  VARCHAR(50),column29  VARCHAR(50),column30  VARCHAR(50),column31  VARCHAR(50),column32  VARCHAR(50),column33 VARCHAR(50),column34 VARCHAR(50),column35 VARCHAR(50),column36 VARCHAR(50),column37 VARCHAR(50), column38  VARCHAR(50),column39  VARCHAR(50),column40  VARCHAR(50),column41  VARCHAR(50),column42  VARCHAR(50),column43 VARCHAR(50),column44 VARCHAR(50),column45 VARCHAR(50),column46 VARCHAR(50),column47 VARCHAR(50), column48  VARCHAR(50),column49  VARCHAR(50),column50  VARCHAR(50)		)"),
		nil, newTestResult().addResult(ruleName))

	runAIRuleCase(rule, t, "case 6: UPDATE语句长度小于1024字符",
		"UPDATE test_table SET column1 = 'value1' WHERE id = 1;",
		session.NewAIMockContext().WithSQL("CREATE TABLE test_table (id int,column1  VARCHAR(50), column2  VARCHAR(50), column3  VARCHAR(50), column4  VARCHAR(50), column5  VARCHAR(50),column6  VARCHAR(50),column7  VARCHAR(50),column8  VARCHAR(50),column9  VARCHAR(50),column10  VARCHAR(50), column11  VARCHAR(50), column12  VARCHAR(50), column13  VARCHAR(50),column14  VARCHAR(50),column15  VARCHAR(50),column16  VARCHAR(50), column17  VARCHAR(50), column18  VARCHAR(50), column19  VARCHAR(50),column20  VARCHAR(50),column21  VARCHAR(50),column22  VARCHAR(50),column23 VARCHAR(50),column24 VARCHAR(50),column25 VARCHAR(50),column26 VARCHAR(50),column27 VARCHAR(50), column28  VARCHAR(50),column29  VARCHAR(50),column30  VARCHAR(50),column31  VARCHAR(50),column32  VARCHAR(50),column33 VARCHAR(50),column34 VARCHAR(50),column35 VARCHAR(50),column36 VARCHAR(50),column37 VARCHAR(50), column38  VARCHAR(50),column39  VARCHAR(50),column40  VARCHAR(50),column41  VARCHAR(50),column42  VARCHAR(50),column43 VARCHAR(50),column44 VARCHAR(50),column45 VARCHAR(50),column46 VARCHAR(50),column47 VARCHAR(50), column48  VARCHAR(50),column49  VARCHAR(50),column50  VARCHAR(50)		)"),
		nil, newTestResult())

	runAIRuleCase(rule, t, "case 7: SELECT语句长度超过1024字符",
		"SELECT column1, column2, column3, column4, column5, column6, column7, column8, column9, column10, column11, column12, column13, column14, column15, column16, column17, column18, column19, column20, column21, column22, column23, column24, column25, column26, column27, column28, column29, column30, column31, column32, column33, column34, column35, column36, column37, column38, column39, column40, column41, column42, column43, column44, column45, column46, column47, column48, column49, column50 FROM test_table WHERE column1 = 'value1' AND column2 = 'value2' AND column3 = 'value3' AND column4 = 'value4' AND column5 = 'value5' AND column6 = 'value6' AND column7 = 'value7' AND column8 = 'value8' AND column9 = 'value9' AND column10 = 'value10' AND column11 = 'value11' AND column12 = 'value12' AND column13 = 'value13' AND column14 = 'value14' AND column15 = 'value15' AND column16 = 'value16' AND column17 = 'value17' AND column18 = 'value18' AND column19 = 'value19' AND column20 = 'value20' AND column21 = 'value21' AND column22 = 'value22' AND column23 = 'value23' AND column24 = 'value24' AND column25 = 'value25' AND column26 = 'value26' AND column27 = 'value27' AND column28 = 'value28' AND column29 = 'value29' AND column30 = 'value30' AND column31 = 'value31' AND column32 = 'value32' AND column33 = 'value33' AND column34 = 'value34' AND column35 = 'value35' AND column36 = 'value36' AND column37 = 'value37' AND column38 = 'value38' AND column39 = 'value39' AND column40 = 'value40' AND column41 = 'value41' AND column42 = 'value42' AND column43 = 'value43' AND column44 = 'value44' AND column45 = 'value45' AND column46 = 'value46' AND column47 = 'value47' AND column48 = 'value48' AND column49 = 'value49' AND column50 = 'value50';",
		session.NewAIMockContext().WithSQL("CREATE TABLE test_table (column1  VARCHAR(50), column2  VARCHAR(50), column3  VARCHAR(50), column4  VARCHAR(50), column5  VARCHAR(50),column6  VARCHAR(50),column7  VARCHAR(50),column8  VARCHAR(50),column9  VARCHAR(50),column10  VARCHAR(50), column11  VARCHAR(50), column12  VARCHAR(50), column13  VARCHAR(50),column14  VARCHAR(50),column15  VARCHAR(50),column16  VARCHAR(50), column17  VARCHAR(50), column18  VARCHAR(50), column19  VARCHAR(50),column20  VARCHAR(50),column21  VARCHAR(50),column22  VARCHAR(50),column23 VARCHAR(50),column24 VARCHAR(50),column25 VARCHAR(50),column26 VARCHAR(50),column27 VARCHAR(50), column28  VARCHAR(50),column29  VARCHAR(50),column30  VARCHAR(50),column31  VARCHAR(50),column32  VARCHAR(50),column33 VARCHAR(50),column34 VARCHAR(50),column35 VARCHAR(50),column36 VARCHAR(50),column37 VARCHAR(50), column38  VARCHAR(50),column39  VARCHAR(50),column40  VARCHAR(50),column41  VARCHAR(50),column42  VARCHAR(50),column43 VARCHAR(50),column44 VARCHAR(50),column45 VARCHAR(50),column46 VARCHAR(50),column47 VARCHAR(50), column48  VARCHAR(50),column49  VARCHAR(50),column50  VARCHAR(50)		)"),
		nil, newTestResult().addResult(ruleName))

	runAIRuleCase(rule, t, "case 8: SELECT语句长度小于1024字符",
		"SELECT column1 FROM test_table WHERE column1 = 'value1';",
		session.NewAIMockContext().WithSQL("CREATE TABLE test_table (column1  VARCHAR(50), column2  VARCHAR(50), column3  VARCHAR(50), column4  VARCHAR(50), column5  VARCHAR(50),column6  VARCHAR(50),column7  VARCHAR(50),column8  VARCHAR(50),column9  VARCHAR(50),column10  VARCHAR(50), column11  VARCHAR(50), column12  VARCHAR(50), column13  VARCHAR(50),column14  VARCHAR(50),column15  VARCHAR(50),column16  VARCHAR(50), column17  VARCHAR(50), column18  VARCHAR(50), column19  VARCHAR(50),column20  VARCHAR(50),column21  VARCHAR(50),column22  VARCHAR(50),column23 VARCHAR(50),column24 VARCHAR(50),column25 VARCHAR(50),column26 VARCHAR(50),column27 VARCHAR(50), column28  VARCHAR(50),column29  VARCHAR(50),column30  VARCHAR(50),column31  VARCHAR(50),column32  VARCHAR(50),column33 VARCHAR(50),column34 VARCHAR(50),column35 VARCHAR(50),column36 VARCHAR(50),column37 VARCHAR(50), column38  VARCHAR(50),column39  VARCHAR(50),column40  VARCHAR(50),column41  VARCHAR(50),column42  VARCHAR(50),column43 VARCHAR(50),column44 VARCHAR(50),column45 VARCHAR(50),column46 VARCHAR(50),column47 VARCHAR(50), column48  VARCHAR(50),column49  VARCHAR(50),column50  VARCHAR(50)		)"),
		nil, newTestResult())

	runAIRuleCase(rule, t, "case 9: 复杂SELECT语句长度超过1024字符",
		"SELECT a.column1, a.column2, b.column3, b.column4 , c.column3, c.column4 , d.column3, d.column4 FROM (SELECT column1, column2 FROM test_table WHERE column1 = 'value1' AND column2 = 'value2') a JOIN (SELECT column3, column4 FROM test_table WHERE column3 = 'value3' AND column4 = 'value4') b JOIN (SELECT column3, column4 FROM test_table WHERE column3 = 'value3' AND column4 = 'value4') c JOIN (SELECT column3, column4 FROM test_table WHERE column3 = 'value3' AND column4 = 'value4') d ON a.column1 = b.column3 AND a.column2 = b.column4 AND c.column1 = d.column3 AND c.column2 = d.column4 WHERE a.column1 = 'value1' AND b.column3 = 'value3' AND a.column2 = 'value2' AND b.column4 = 'value4' AND a.column1 = 'value1' AND b.column3 = 'value3' AND a.column2 = 'value2' AND b.column4 = 'value4' AND a.column1 = 'value1' AND b.column3 = 'value3' AND a.column2 = 'value2' AND b.column4 = 'value4' AND a.column1 = 'value1' AND b.column3 = 'value3' AND a.column2 = 'value2' AND b.column4 = 'value4' AND c.column2 = 'value2' AND c.column4 = 'value4' AND c.column3 = 'value3' AND c.column3 = 'value3' AND d.column2 = 'value2' AND d.column4 = 'value4' AND d.column3 = 'value3' AND d.column3 = 'value3' ;",
		session.NewAIMockContext().WithSQL("CREATE TABLE test_table (column1  VARCHAR(50), column2  VARCHAR(50), column3  VARCHAR(50), column4  VARCHAR(50), column5  VARCHAR(50),column6  VARCHAR(50),column7  VARCHAR(50),column8  VARCHAR(50),column9  VARCHAR(50),column10  VARCHAR(50), column11  VARCHAR(50), column12  VARCHAR(50), column13  VARCHAR(50),column14  VARCHAR(50),column15  VARCHAR(50),column16  VARCHAR(50), column17  VARCHAR(50), column18  VARCHAR(50), column19  VARCHAR(50),column20  VARCHAR(50),column21  VARCHAR(50),column22  VARCHAR(50),column23 VARCHAR(50),column24 VARCHAR(50),column25 VARCHAR(50),column26 VARCHAR(50),column27 VARCHAR(50), column28  VARCHAR(50),column29  VARCHAR(50),column30  VARCHAR(50),column31  VARCHAR(50),column32  VARCHAR(50),column33 VARCHAR(50),column34 VARCHAR(50),column35 VARCHAR(50),column36 VARCHAR(50),column37 VARCHAR(50), column38  VARCHAR(50),column39  VARCHAR(50),column40  VARCHAR(50),column41  VARCHAR(50),column42  VARCHAR(50),column43 VARCHAR(50),column44 VARCHAR(50),column45 VARCHAR(50),column46 VARCHAR(50),column47 VARCHAR(50), column48  VARCHAR(50),column49  VARCHAR(50),column50  VARCHAR(50)		)"),
		nil, newTestResult().addResult(ruleName))

	runAIRuleCase(rule, t, "case 10: 复杂SELECT语句长度小于1024字符",
		"SELECT a.column1, b.column3 FROM (SELECT column1 FROM test_table WHERE column1 = 'value1') a JOIN (SELECT column3 FROM test_table WHERE column3 = 'value3') b ON a.column1 = b.column3 WHERE a.column1 = 'value1' AND b.column3 = 'value3';",
		session.NewAIMockContext().WithSQL("CREATE TABLE test_table (column1  VARCHAR(50), column2  VARCHAR(50), column3  VARCHAR(50), column4  VARCHAR(50), column5  VARCHAR(50),column6  VARCHAR(50),column7  VARCHAR(50),column8  VARCHAR(50),column9  VARCHAR(50),column10  VARCHAR(50), column11  VARCHAR(50), column12  VARCHAR(50), column13  VARCHAR(50),column14  VARCHAR(50),column15  VARCHAR(50),column16  VARCHAR(50), column17  VARCHAR(50), column18  VARCHAR(50), column19  VARCHAR(50),column20  VARCHAR(50),column21  VARCHAR(50),column22  VARCHAR(50),column23 VARCHAR(50),column24 VARCHAR(50),column25 VARCHAR(50),column26 VARCHAR(50),column27 VARCHAR(50), column28  VARCHAR(50),column29  VARCHAR(50),column30  VARCHAR(50),column31  VARCHAR(50),column32  VARCHAR(50),column33 VARCHAR(50),column34 VARCHAR(50),column35 VARCHAR(50),column36 VARCHAR(50),column37 VARCHAR(50), column38  VARCHAR(50),column39  VARCHAR(50),column40  VARCHAR(50),column41  VARCHAR(50),column42  VARCHAR(50),column43 VARCHAR(50),column44 VARCHAR(50),column45 VARCHAR(50),column46 VARCHAR(50),column47 VARCHAR(50), column48  VARCHAR(50),column49  VARCHAR(50),column50  VARCHAR(50)		)"),
		nil, newTestResult())
}

// ==== Rule test code end ====
